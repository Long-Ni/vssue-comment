(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{505:function(t,e,n){t.exports=n.p+"assets/img/2-1-peering.840bc6e2.png"},563:function(t,e,n){"use strict";n.r(e);var a=n(8),v=Object(a.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("包含以下内容：")]),t._v(" "),a("ul",[a("li",[t._v("私有 VPC。")]),t._v(" "),a("li",[t._v("私有 VPC 与其他 VPC 建立对等连接。")]),t._v(" "),a("li",[t._v("使用 Elastic Beanstalk 在私有 VPC 中创建环境并部署代码。")])]),t._v(" "),a("p",[t._v("目录：")]),t._v(" "),a("TOC",{attrs:{"include-level":[2,4]}}),t._v(" "),a("h2",{attrs:{id:"_1-创建-private-vpc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建-private-vpc"}},[t._v("#")]),t._v(" 1. 创建 Private VPC")]),t._v(" "),a("p",[t._v("创建私有 VPC （Private VPC）。Private VPC 是没有公有子网和互联网网关的 VPC。整个网络不接入 Internet。")]),t._v(" "),a("p",[t._v("Private VPC 特点：")]),t._v(" "),a("ul",[a("li",[t._v("该 VPC 没有互联网网关。")]),t._v(" "),a("li",[t._v("该 VPC 没有 NAT 设备。")]),t._v(" "),a("li",[t._v("VPC 中所有流量不接入互联网。")])]),t._v(" "),a("h2",{attrs:{id:"_2-创建子网-subnet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-创建子网-subnet"}},[t._v("#")]),t._v(" 2. 创建子网（Subnet）")]),t._v(" "),a("p",[t._v("创建多个子网，通过路由表将不同子网的流量指向不同的对等 VPC。创建"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/peering-configurations-partial-access.html#one-to-two-vpcs-simple-hub",target:"_blank",rel:"noopener noreferrer"}},[t._v("两个 VPC 与一个 VPC 中的两个子网对等"),a("OutboundLink")],1),t._v("型的对等连接。")]),t._v(" "),a("p",[a("img",{attrs:{src:n(505),alt:"两个 VPC 与一个 VPC 中的两个子网对等"}})]),t._v(" "),a("h2",{attrs:{id:"_3-创建-vpc-对等连接-peering-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-创建-vpc-对等连接-peering-connection"}},[t._v("#")]),t._v(" 3. 创建 VPC 对等连接（Peering Connection）")]),t._v(" "),a("p",[t._v("VPC 对等连接是两个 VPC 之间的网络连接，可通过此连接不公开地在这两个 VPC 之间路由流量。这两个 VPC 中的实例可以彼此通信，就像它们在同一网络中一样。")]),t._v(" "),a("h3",{attrs:{id:"_3-1-vpc-peering-connection-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-vpc-peering-connection-使用"}},[t._v("#")]),t._v(" 3.1 VPC Peering Connection 使用")]),t._v(" "),a("h4",{attrs:{id:"_3-1-0-前提"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-0-前提"}},[t._v("#")]),t._v(" 3.1.0 前提")]),t._v(" "),a("p",[t._v("VPC-A（Private VPC）、VPC-B 和 VPC-C 已经创建。假设 VPC 相关数据为：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("VPC Name")]),t._v(" "),a("th",[t._v("VPC CIDR")]),t._v(" "),a("th",[t._v("Internet Gateway(Connect to internet)")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("VPC-A")]),t._v(" "),a("td",[t._v("172.16.0.0/24")]),t._v(" "),a("td",[t._v("N")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-B")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-C")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("Y")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-1-1-创建并接受-vpc-peering-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-创建并接受-vpc-peering-connection"}},[t._v("#")]),t._v(" 3.1.1 创建并接受 VPC Peering Connection")]),t._v(" "),a("p",[t._v("创建步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/create-vpc-peering-connection.html#create-vpc-peering-connection-local",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建 VPC Peering Connection"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("接受步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/create-vpc-peering-connection.html#accept-vpc-peering-connection",target:"_blank",rel:"noopener noreferrer"}},[t._v("接受 VPC Peering Connection"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("查看步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/create-vpc-peering-connection.html#accept-vpc-peering-connection",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看 VPC Peering Connection"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"_3-1-2-更新-vpc-创建-peering-connection-中关联子网的路由表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-更新-vpc-创建-peering-connection-中关联子网的路由表"}},[t._v("#")]),t._v(" 3.1.2 更新 VPC （创建 Peering Connection）中关联子网的路由表")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("目的")]),t._v("：将流量路由到对等 VPC （VPC-B、VPC-C）中。将不同子网的流量路由到不同的对等 VPC 中。（Subnet X to VPC-B，Subnet Y to VPC-C）")])]),t._v(" "),a("p",[t._v("VPC-A 中 Subnet X 的路由表指向 VPC 对等连接 "),a("code",[t._v("pcx-bbbbbbb")]),t._v(" 以访问 VPC-B 的整个 CIDR 块。")]),t._v(" "),a("p",[t._v("VPC-A 中 Subnet Y 的路由表指向 VPC 对等连接 "),a("code",[t._v("pcx-ccccccc")]),t._v(" 以访问 VPC-C 的整个 CIDR 块。")]),t._v(" "),a("p",[t._v("步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/vpc-peering-routing.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("为 VPC 对等连接添加 IPv4 路由"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("可以参考："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/peering-configurations-partial-access.html#one-to-two-vpcs-simple-hub",target:"_blank",rel:"noopener noreferrer"}},[t._v("两个 VPC 与一个 VPC 中的两个子网对等"),a("OutboundLink")],1)]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Router Table Name")]),t._v(" "),a("th",[t._v("Destination")]),t._v(" "),a("th",[t._v("Target")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("VPC-A 中的 Subnet X")]),t._v(" "),a("td",[t._v("172.16.0.0/24")]),t._v(" "),a("td",[t._v("local(默认存在)")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-A 中的 Subnet X")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("pcx-bbbbbbb")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-A 中的 Subnet Y")]),t._v(" "),a("td",[t._v("172.16.0.0/24")]),t._v(" "),a("td",[t._v("loacl(默认存在)")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-A 中的 Subnet Y")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("pcx-ccccccc")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-1-3-更新对等-vpc-接受-peering-connection-中的路由表x"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-3-更新对等-vpc-接受-peering-connection-中的路由表x"}},[t._v("#")]),t._v(" 3.1.3 更新对等 VPC（接受 Peering Connection） 中的路由表X")]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("目的")]),t._v("：将流量定向回 VPC （VPC-A）中。（VPC-B to Subnet X，VPC-C to Subnet Y）")])]),t._v(" "),a("p",[t._v("VPC-B 的路由表指向 "),a("code",[t._v("pcx-bbbbbbb")]),t._v(" 以便仅访问 VPC-A 中 Sunbet X 的 CIDR 块。")]),t._v(" "),a("p",[t._v("VPC-C 的路由表指向 "),a("code",[t._v("pcx-ccccccc")]),t._v(" 以便仅访问 VPC-A 中 Subnet Y 的 CIDR 块。")]),t._v(" "),a("p",[t._v("步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/vpc-peering-routing.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("为 VPC 对等连接添加 IPv4 路由"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("可以参考："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/peering-configurations-partial-access.html#one-to-two-vpcs-simple-hub",target:"_blank",rel:"noopener noreferrer"}},[t._v("两个 VPC 与一个 VPC 中的两个子网对等"),a("OutboundLink")],1)]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Router Table Name")]),t._v(" "),a("th",[t._v("Destination")]),t._v(" "),a("th",[t._v("Target")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("VPC-B")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("local(默认存在)")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-B")]),t._v(" "),a("td",[t._v("172.16.0.0/25")]),t._v(" "),a("td",[t._v("pcx-bbbbbbb")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-C")]),t._v(" "),a("td",[t._v("192.168.0.0/16")]),t._v(" "),a("td",[t._v("local(默认存在)")])]),t._v(" "),a("tr",[a("td",[t._v("VPC-C")]),t._v(" "),a("td",[t._v("172.16.0.128/25")]),t._v(" "),a("td",[t._v("pcx-ccccccc")])])])]),t._v(" "),a("h4",{attrs:{id:"_3-1-4-引用安全组"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-4-引用安全组"}},[t._v("#")]),t._v(" 3.1.4 引用安全组")]),t._v(" "),a("blockquote",[a("p",[t._v("目的：允许通过路由表路由过来的流量访问实例。")])]),t._v(" "),a("p",[t._v("在 Private VPC 中新建一个安全组，更新入站规则以引用对等 VPC 中安全组。此操作将 Private VPC 中的实例允许流量流入和流出与对等 VPC 中已经引用该安全组的实例。")]),t._v(" "),a("p",[t._v("例1：通过安全组入站规则，建立实例间双向通讯：")]),t._v(" "),a("p",[t._v("VPC-B 中存在以下默认安全组（sg-58f5ab55），并且被 VPC-B 中实例 Instance-B 所引用。")]),t._v(" "),a("p",[a("strong",[t._v("默认安全组：它允许来自分配给相同安全组的网络接口及其关联实例的入站流量。")])]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("All traffic")]),t._v(" "),a("td",[t._v("All")]),t._v(" "),a("td",[t._v("All")]),t._v(" "),a("td",[t._v("sg-58f5ab55")])])])]),t._v(" "),a("p",[t._v("建立对等连接后，要使 Private VPC 中的实例（Instance-A）与 VPC-B 中实例 Instance-B 通信，则须将该安全组引入到 Private VPC 中的实例 Instance-A 上。在 VPC-A 中创建以下安全组并引入其实例中：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("All traffic")]),t._v(" "),a("td",[t._v("All")]),t._v(" "),a("td",[t._v("All")]),t._v(" "),a("td",[t._v("sg-58f5ab55")])])])]),t._v(" "),a("p",[t._v("通过以上路由表和安全组的设置，Instance-A 与 Instance-B 可以彼此通过私有 IP 通信，就像它们在同一个网络中一样。")]),t._v(" "),a("p",[t._v("例2：通过安全组入站规则，也可以建立 Instance-B 到 Instance-A的单向通讯（此处推荐使用自定义安全组）：")]),t._v(" "),a("p",[t._v("将以下安全组关联到 Instance-A")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")]),t._v(" "),a("th",[t._v("Description - optional")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("SSH")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("22")]),t._v(" "),a("td",[t._v("192.168.0.0/32（Instance-B 的 IP 或者 Instance-B 所在子网的 CIDR 块）")]),t._v(" "),a("td",[t._v("允许来自 Instance-B 的 SSH 流量")])]),t._v(" "),a("tr",[a("td",[t._v("HTTP")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("80")]),t._v(" "),a("td",[t._v("192.168.0.0/32（Instance-B 的 IP 或者 Instance-B 所在子网的 CIDR 块）")]),t._v(" "),a("td",[t._v("允许来自 Instance-B 的 HTTP 流量")])]),t._v(" "),a("tr",[a("td",[t._v("HTTPS")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("443")]),t._v(" "),a("td",[t._v("192.168.0.0/32（Instance-B 的 IP 或者 Instance-B 所在子网的 CIDR 块）")]),t._v(" "),a("td",[t._v("允许来自 Instance-B 的 HTTPS 流量")])])])]),t._v(" "),a("h3",{attrs:{id:"_3-2-关于-vpc-peering-connection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-关于-vpc-peering-connection"}},[t._v("#")]),t._v(" 3.2 关于 VPC Peering Connection")]),t._v(" "),a("p",[a("strong",[t._v("Peering Connection")]),t._v(" 特点：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("建立 Peering Connection 的两个 VPC 中的实例可以彼此通信，就像他们在同一个网络中一样。")])]),t._v(" "),a("li",[a("strong",[t._v("使用私有 IP 进行通信")])]),t._v(" "),a("li",[a("strong",[t._v("跨 VPC 可以访问的资源包括 EC2 Instance、Amazon RDS数据库和 Lambda 函数。")])]),t._v(" "),a("li",[t._v("所有区域间流量都经过加密，没有单点故障或带宽瓶颈。")]),t._v(" "),a("li",[t._v("流量一直处于全球 AWS 骨干网中，不会经过公共 Internet，这样可以减少面临的威胁，例如常见漏洞和 DDos 攻击。")]),t._v(" "),a("li",[t._v("区域间 VPC 对等连接提供了一种在区域间共享资源或为实现地理冗余性而复制数据的简单经济方式。")])]),t._v(" "),a("p",[t._v("如果对等关系中的任一 VPC 具有下列连接之一，则"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/peering/invalid-peering-configurations.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("无法将对等关系扩展到该连接"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("ul",[a("li",[t._v("与企业网络之间的 VPN 连接或 AWS Direct Connect 连接。")]),t._v(" "),a("li",[t._v("通过互联网网关（Internet Gateway）建立的 Internet 连接。")]),t._v(" "),a("li",[t._v("在私有子网中通过 NAT 设备建立的 Internet  连接。")]),t._v(" "),a("li",[t._v("AWS 服务的网关终端节点（Endpoint of gateway type）；例如，Amazon S3 的终端节点。")]),t._v(" "),a("li",[t._v("（IPv6）ClassicLink 连接。")])]),t._v(" "),a("h2",{attrs:{id:"_4-创建-vpc-终端节点-endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-创建-vpc-终端节点-endpoint"}},[t._v("#")]),t._v(" 4. 创建 VPC 终端节点（Endpoint）")]),t._v(" "),a("p",[t._v("通过 Endpoint 建立 PrivateLink，以允许 AWS 服务（Elastic Beanstalk，s3，CloudFormation，SQS，CloudWatch...）连接到 Private VPC 中，对其进行操作。使整个网络只存在与 AWS 主干网内，而不接入互联网（internet）。")]),t._v(" "),a("h3",{attrs:{id:"_4-1-vpc-endpoint-使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-vpc-endpoint-使用"}},[t._v("#")]),t._v(" 4.1 VPC Endpoint 使用")]),t._v(" "),a("h4",{attrs:{id:"_4-1-0-前提"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-0-前提"}},[t._v("#")]),t._v(" 4.1.0 前提")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("在其 VPC 内创建两个私有子网。")])]),t._v(" "),a("li",[a("p",[t._v("启用 VPC 的 DNS 支持。将两项属性设置为 "),a("code",[t._v("true")]),t._v("："),a("code",[t._v("DNS Resolution")]),t._v(" & "),a("code",[t._v("DNS Hostnames")])]),t._v(" "),a("p",[t._v("步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpc-dns.html#vpc-dns-updating",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看和更新针对 VPC 的 DNS 支持"),a("OutboundLink")],1)])])]),t._v(" "),a("h4",{attrs:{id:"_4-1-1-创建与查看-interface-endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-1-创建与查看-interface-endpoint"}},[t._v("#")]),t._v(" 4.1.1 创建与查看 Interface Endpoint")]),t._v(" "),a("p",[t._v("创建步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpce-interface.html#create-interface-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建 Interface Endpoint"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("依次为以下 Amazon "),a("span",{attrs:{id:"amazon-service-endpoint"}},[t._v("服务")]),t._v("创建 Interface Endpoint：")]),t._v(" "),a("ul",[a("li",[t._v("elasticbeanstalk：（required）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".elasticbeanstalk")]),t._v("。确保 Elastic Beanstalk 与 Private VPC 一起使用。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/vpc-vpce.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("将 Elastic Beanstalk 与 VPC 终端节点结合使用"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("elasticbeanstalk-health：（required）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".elasticbeanstalk-health")]),t._v("。确保 Elastic Beanstalk Enhanced Health 与 Private VPC 一起使用。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/health-enhanced.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Elastic Beanstalk Enhanced Health"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("cloudformation：（required）服务名称为"),a("code",[t._v("com.amazooptionnaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".cloudformation")]),t._v("。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/cfn-vpce-bucketnames.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("设置 AWS CloudFormation 的 VPC 终端节点"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AWSCloudFormation/latest/UserGuide/Welcome.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS CloudFormation"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("events：（optional）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".events")]),t._v("。确保 CloudWatch Events 与 Private VPC 一起使用。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/events/cloudwatch-events-and-interface-VPC.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("将 CloudWatch Events 和接口 VPC 终端节点一起使用"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/events/WhatIsCloudWatchEvents.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon CloudWatch Events"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("logs：（required）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".logs")]),t._v("。确保 CloudWatch Logs 与 Private VPC 一起使用。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/logs/cloudwatch-logs-and-interface-VPC.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("将 CloudWatch Logs 和接口 VPC 终端节点一起使用"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/logs/WhatIsCloudWatchLogs.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon CloudWatch Log"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("monitoring：（optional）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".monitoring")]),t._v("。确保 CloudWatch 与 Private VPC 一起使用。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/monitoring/cloudwatch-and-interface-VPC.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("为 CloudWatch 创建 VPC 终端节点"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonCloudWatch/latest/monitoring/WhatIsCloudWatch.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon CloudWatch"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("sqs：（required）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".sqs")]),t._v("。确保 Amazon SQS 与 Private VPC 一起使用。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-internetwork-traffic-privacy.html#sqs-vpc-endpoints",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon SQS 的 Amazon Virtual Private Cloud 终端节点"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-sending-messages-from-vpc.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon SQS"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("创建 Interface Endpoint 时需要重点注意的点：")]),t._v(" "),a("ol",[a("li",[t._v("Enable DNS name：true。环境实例上的 Elastic Beanstalk 代码使用公有终端节点将流量发送到所有 AWS 服务。要确保此流量通过，请在配置所有接口 VPC Endpoint 时选择 "),a("strong",[t._v("Enable DNS name")]),t._v(" 选项。这会在你的 VPC 中添加一个 DNS 条目（entry），该条目将公有服务终端节点映射到接口 VPC 终端节点。")]),t._v(" "),a("li",[t._v("选择要在其中创建 Endpoint 的子网。可以在不同的可用区中指定多个子网 (在服务支持的情况下)，以帮助确保你的 Interface Endpoint 能够在出现可用区故障时复原。在此情况下，我们将在你指定的每个子网中创建一个终端节点网络接口。")]),t._v(" "),a("li",[t._v("Security Group：如果在创建 Endpoint 时不指定安全组，则系统默认将 VPC 默认安全组关联到该 Endpoint 上。要使 Endpoint 与实例通信，则启动实例时必须将该默认安全组关联到实例。（"),a("span",{attrs:{id:"default-security-group"}},[t._v("默认安全组")]),t._v("允许来自分配给相同安全组的网络接口及其关联实例的入站流量，创建 Endpoint 时推荐选择默认安全组）")])]),t._v(" "),a("p",[t._v("查看步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpce-interface.html#describe-interface-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("查看 Interface Endpoint"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"_4-1-2-创建-gateway-endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-2-创建-gateway-endpoint"}},[t._v("#")]),t._v(" 4.1.2 创建 Gateway Endpoint")]),t._v(" "),a("p",[t._v("步骤："),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpce-gateway.html#create-gateway-endpoint",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建 Gateway Endpoint"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("为以下 Amazon 服务创建 Gateway Endpoint：")]),t._v(" "),a("ul",[a("li",[t._v("s3：（required）服务名称为"),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".s3")]),t._v("。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/vpc/latest/userguide/vpc-endpoints-s3.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon S3 的终端节点"),a("OutboundLink")],1),t._v("。关于 "),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/gsg/GetStartedWithS3.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Amazon S3"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("创建 Gateway Endpoint 时需要注意的点：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("选择用于通过 Endpoint 访问 s3 服务的路由表。路由会自动添加到每个路由表中，其 destination 是 s3 服务的 AWS 前缀列表 ID（"),a("code",[t._v("pl-xxxxxxxx")]),t._v("），target 是 Endpoint ID（"),a("code",[t._v("vpce-xxxxxxxx")]),t._v("）。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Destination")]),t._v(" "),a("th",[t._v("Target")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("172.16.0.0/24")]),t._v(" "),a("td",[t._v("local")])]),t._v(" "),a("tr",[a("td",[t._v("pl-1a2b3c4d")]),t._v(" "),a("td",[t._v("vpce-11bb22cc")])])])])]),t._v(" "),a("li",[a("p",[t._v("Amazon s3 的AWS 前缀列表 ID 使用 "),a("code",[t._v("pl-xxxxxxx")]),t._v(" 格式，Amazon s3  的 AWS 前缀列表名称使用 "),a("code",[t._v("com.amazonaws.")]),a("code",{staticStyle:{color:"red"}},[t._v("region")]),a("code",[t._v(".s3")]),t._v(" 格式。")])])]),t._v(" "),a("p",[t._v("通过以上设置，已经为 Private VPC 创建 8 个 Endpoint。其中 6 为必须创建，2 个可选创建（Amazon CloudWatch）。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Service Name")]),t._v(" "),a("th",[t._v("Service Type")]),t._v(" "),a("th",[t._v("Required")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("elasticbeanstalk")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("elasticbeanstalk-health")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("cloudformation")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("sqs")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("logs")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("s3")]),t._v(" "),a("td",[t._v("Gateway")]),t._v(" "),a("td",[t._v("Y")])]),t._v(" "),a("tr",[a("td",[t._v("events")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("N")])]),t._v(" "),a("tr",[a("td",[t._v("monitoring")]),t._v(" "),a("td",[t._v("Interface")]),t._v(" "),a("td",[t._v("N")])])])]),t._v(" "),a("h3",{attrs:{id:"_4-2-关于-vpc-endpoint"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-关于-vpc-endpoint"}},[t._v("#")]),t._v(" 4.2 关于 VPC Endpoint")]),t._v(" "),a("p",[t._v("VPC Endpoint 可通过 AWS privateLink 实现 Private VPC 与支持的 AWS services、VPC endpoint services 之间的私有连接。")]),t._v(" "),a("p",[t._v("AWS PrivateLink 是使你能够通过 private IP 私密访问服务的一项技术。")]),t._v(" "),a("p",[a("strong",[t._v("VPC Endpoint 特点：")])]),t._v(" "),a("ul",[a("li",[t._v("VPC Endpoint 使你能够将 VPC 私密地连接到支持的 AWS services 和 VPC endpoint services（由 AWS PrivateLink 提供支持），而无需互联网网关、NAT 设备、VPN 连接或 AWS Direct Connect 连接。")]),t._v(" "),a("li",[t._v("VPC 中的实例无需公有 IP 地址便可与服务中的资源进行通信。")]),t._v(" "),a("li",[t._v("VPC 和其他服务之间的流量不会脱离 Amazon 网络。")]),t._v(" "),a("li",[t._v("Endpoint 是虚拟设备。它们是水平扩展、冗余和高度可用的 VPC 组件。")])]),t._v(" "),a("p",[t._v("VPC Endpoint 有两种类型：")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Interface Endpoint：是一个弹性网络接口，具有来自子网 IP 地址范围的私有 IP 地址，用作发送到受支持的服务的通信入口点。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("对于每个接口终端节点，每个可用区您只能选择一个子网。")])]),t._v(" "),a("li",[a("p",[t._v("某些服务支持使用 Endpoint 策略来控制对服务的访问。")])]),t._v(" "),a("li",[a("p",[t._v("一些可用区不支持 Interface Endpoint 服务。")])]),t._v(" "),a("li",[a("p",[t._v("如果子网的网络 ACL 限制流量，您可能无法通过终端节点网络接口发送流量。请确保您增加了相应的规则，允许与子网的 CIDR 块之间的往返流量。")])]),t._v(" "),a("li",[a("p",[t._v("接口终端节点仅支持 TCP 流量。")])]),t._v(" "),a("li",[a("p",[t._v("仅在同一区域内支持 Endpoint。无法在 VPC 和其他区域内的服务之间创建终端节点。")]),t._v(" "),a("p",[a("strong",[t._v("Private DNS for Interface Endpoint：")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("创建 Interface Endpoint 时，将会生成可用于与服务通信的端点特定的 DNS 主机名（Endpoint-specific DNS hostnames："),a("code",[t._v("vpce-000000000-yyyyyyy.elasticbeanstalk.ap-northeast-1.vpce.amazonaws.com")]),t._v("）。")])]),t._v(" "),a("li",[a("p",[t._v("对于 AWS 服务和 AWS Marketplace 合作伙伴服务，私有 DNS 选项（默认启用）会将私有托管区域（private hosted zone）与你的 VPC 相关联。")])]),t._v(" "),a("li",[a("p",[t._v("托管区域包含服务的默认 DNS 名称（Default DNS name："),a("code",[t._v("elasticbeanstalk.ap-northeast-1.amazonaws.com")]),t._v("）的记录集，用于解析你的 VPC 中的 endpoint network interface 的私有 IP 地址。这使你能够使用服务的默认 DNS 主机名而不是终端节点特定 DNS 主机名向服务发出请求。")])]),t._v(" "),a("li",[a("p",[t._v("Endpoint 未启用 private DNS ：任一子网中的实例都可以使用端点特定的 DNS 主机名通过 Interface Endpoint 向 Amazon 服务发送请求。公有子网中的实例可以使用其默认 DNS 名称，通过 AWS 区域中的公有 IP 地址空间与  Amazon 服务通信。")])]),t._v(" "),a("li",[a("p",[t._v("Endpoint 启用 private DNS ：任一子网中的实例都可以使用默认的 DSN 主机名或端点特定的 DNS 主机名，通过 Interface Endpoint 向 Amazon 服务发送请求。")])]),t._v(" "),a("li",[a("p",[t._v("在 Private VPC 中使用 Endpoint 必须启用 private DNS。（如果你的 VPC 不是私有的，且具有 Internet 访问权限，如果将 VPC Endpoint 禁用了 "),a("strong",[t._v("Enable DNS name")]),t._v("，则流向相应服务的流量将通过 Internet 传输。这可能不是你期望的。使用 Private VPC 可以检测到这个问题，因为它可以防止此流量通过并且返回错误。对于公有 VPC 不会有任何指示。）")]),t._v(" "),a("article",{staticStyle:{"background-color":"#e9f7e8",padding:"16px 16px 16px 16px"}},[a("p",{staticStyle:{margin:"0px 0px 8px"}},[a("b",[t._v("注意：")])]),t._v(" "),a("p",{staticStyle:{margin:"0px"}},[t._v("要启用 Private DNS，必须将 VPC 的以下属性设置为 true：\nenableDnsHostnames 和 enableDnsSupport。")])])])])])])]),t._v(" "),a("li",[a("p",[t._v("Gateway Endpoint：是一个网关，作为路由表中指定路由的目标，用于发往受支持的 AWS 服务的流量。")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("仅支持 IPv4 流量")])]),t._v(" "),a("li",[a("p",[t._v("仅在同一区域内支持 Endpoint。无法在 VPC 和其他区域内的服务之间创建终端节点")])])])])]),t._v(" "),a("h2",{attrs:{id:"_5-使用-eb-在-private-vpc-中创建环境并部署代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-使用-eb-在-private-vpc-中创建环境并部署代码"}},[t._v("#")]),t._v(" 5. 使用 EB 在 Private VPC 中创建环境并部署代码")]),t._v(" "),a("p",[t._v("如果在 Private VPC 中创建 Elastic Beanstalk 环境，则该环境无法访问 Internet。你的应用程序可能访问 Elastic Beanstalk 服务或者其他服务，或者实例会将环境运行状况信息发送到增强型运行状况服务（enhanced health service）。")]),t._v(" "),a("p",[t._v("所以要使用 EB 在 Private VPC 中创建环境并部署代码，必须先在其 Private VPC 中配置 VPC Endpoint，即完成"),a("a",{attrs:{href:"#_4-%E5%88%9B%E5%BB%BA-vpc-%E7%BB%88%E7%AB%AF%E8%8A%82%E7%82%B9-endpoint"}},[t._v("上述第 4 点")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"_5-1-具体操作步骤及注意点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-具体操作步骤及注意点"}},[t._v("#")]),t._v(" 5.1 具体操作步骤及注意点")]),t._v(" "),a("p",[a("strong",[t._v("使用 EB 在 Private VPC 中创建环境并部署代码")])]),t._v(" "),a("h4",{attrs:{id:"_5-1-1-创建-application"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-1-创建-application"}},[t._v("#")]),t._v(" 5.1.1 创建 Application")]),t._v(" "),a("p",[t._v("参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/applications.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("管理和配置 Elastic Beanstalk 应用程序"),a("OutboundLink")],1)]),t._v(" "),a("h4",{attrs:{id:"_5-1-2-创建-environmen"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-2-创建-environmen"}},[t._v("#")]),t._v(" 5.1.2 创建 Environmen")]),t._v(" "),a("p",[t._v("参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/using-features.environments.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建 Elastic Beanstalk 环境"),a("OutboundLink")],1)]),t._v(" "),a("ol",[a("li",[t._v("在导航窗格中，选择"),a("strong",[t._v("应用程序")]),t._v("，然后在列表中选择刚才创建的应用程序")]),t._v(" "),a("li",[t._v("在应用程序概述页面上，选择 "),a("strong",[t._v("Create a new environment (创建新环境)")]),t._v("。")]),t._v(" "),a("li",[t._v("选择 "),a("strong",[t._v("Web server environment (Web 服务器环境)")])]),t._v(" "),a("li",[t._v("点击 "),a("strong",[t._v("Select")]),t._v(" 按钮，进入"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-mainpage",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建新环境向导主页面"),a("OutboundLink")],1),t._v(" "),a("ul",[a("li",[t._v("对于 "),a("strong",[t._v("Environment information")]),t._v("：输入 Environment name，Domain 和  Description 可以不用输入。")]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Platform")]),t._v("：选择 "),a("em",[a("strong",[t._v("PHP 7.3 running on 64bit Amazon Linux/2.9.12")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Application code")]),t._v("：暂时选择 "),a("em",[a("strong",[t._v("Sample application")])])]),t._v(" "),a("li",[t._v("其他选项保持默认值或按需")])])]),t._v(" "),a("li",[t._v("点击 "),a("strong",[t._v("Configure more options")]),t._v(" 按钮，进入"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/environments-create-wizard.html#environments-create-wizard-configure",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建新环境向导配置页面"),a("OutboundLink")],1),t._v(" "),a("ul",[a("li",[t._v("对于 "),a("strong",[t._v("Presets (预设)")]),t._v("：此处"),a("span",{staticStyle:{color:"red"}},[t._v("必须")]),t._v("选择 "),a("em",[a("strong",[t._v("High availability")])]),t._v("（此选项将会自动为你创建应用程序负载均衡器 Application Load Balancer 和 Auto Scaling Group）")]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Software")]),t._v("，点击 Software 卡片上 Edit 按钮，进入 Software 设置页面：\n"),a("ul",[a("li",[a("strong",[t._v("Container Options")]),t._v("：此处 "),a("strong",[t._v("Document root")]),t._v(" 填写应用程序欢迎页路径（包含你站点的默认页面的文件夹。如果你的欢迎页面不位于源包的根目录，请指定包含该页面且与根路径相关的文件夹。例如，如果欢迎页面位于名为 "),a("code",[t._v("/public")]),t._v(" 的文件夹中，则值为 "),a("code",[t._v("/public")]),t._v("。此外，环境运行状况是否健康也是去此目录下检查，所以填写错误的情况下，环境将会处于不健康状态。）")]),t._v(" "),a("li",[a("strong",[t._v("Instance log streaming to CloudWatch Logs")]),t._v("：勾选 Log streaming 的 "),a("em",[a("strong",[t._v("Enabled")])]),t._v(" 选项")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Network")]),t._v("，点击 Network 卡片上 Edit 按钮，进入 Network 设置页面：\n"),a("ul",[a("li",[a("strong",[t._v("Virtual private cloud (VPC)")]),t._v("：选择新创建的 Private VPC")]),t._v(" "),a("li",[a("strong",[t._v("Load  balancer settings")]),t._v("： 对于 "),a("strong",[t._v("Visibility")]),t._v(" 此处"),a("span",{staticStyle:{color:"red"}},[t._v("必须")]),t._v("选择 "),a("em",[a("strong",[t._v("internal")])]),t._v("（Private VPC 的情况下），并选择负载均衡子网（子网用于配置负载均衡器，此处至少选择两个子网。由于子网不跨可用区，每个子网处于一个可用区内，所以此处的两个子网必须处于不同的可用区内。参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticloadbalancing/latest/application/application-load-balancers.html#subnets-load-balancer",target:"_blank",rel:"noopener noreferrer"}},[t._v("创建负载均衡器必须至少选择两个可用区子网"),a("OutboundLink")],1),t._v("）")]),t._v(" "),a("li",[a("strong",[t._v("Instance settings")]),t._v("：不勾选 "),a("em",[a("strong",[t._v("Public IP address")])]),t._v(" 选项，并选择实例子网（实例将启动在此时选择的任一子网内。可以选择上述负载均衡器子网，也可以选择其他子网，但实例子网所处可用区与负载均衡器所处可用区必须一致）")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Instances")]),t._v("，点击 Instances 卡片上 Edit 按钮，进入 Instances 设置页面（要完成此步骤，必须先完成对 "),a("strong",[t._v("Network")]),t._v(" 的设置。）：\n"),a("ul",[a("li",[a("strong",[t._v("EC2 security groups")]),t._v("：此处选择安全组时，要确保启动环境过程中能使 EB 启动的 instance 与 Endpoint 进行通信。所以此处选择的安全组与创建 Endpoint 时选择的安全组有关。如果创建 Endpoint 时，为"),a("a",{attrs:{href:"#amazon-service-endpoint"}},[t._v("服务")]),t._v("指定了 VPC 的默认安全组，那么此处"),a("span",{staticStyle:{color:"red"}},[t._v("必须")]),t._v("选择该 VPC 的默认安全组（推荐使用"),a("a",{attrs:{href:"#default-security-group"}},[t._v("默认安全组")]),t._v("）。如果创建 Endpoint 时，为"),a("a",{attrs:{href:"#amazon-service-endpoint"}},[t._v("服务")]),t._v("指定了自定义的安全组（该安全组必须允许来自 instance 流量入站），那么此处必须选择允许来自 Endpoint 流量入站的安全组。（由于 AWS bug，此处可能会显示相同的多的安全组，选择符合条件的其中一个或者多个即可，不必重复选择）")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Capacity")]),t._v("，点击 Capacity 卡片上 Edit 按钮，进入 Capacity 设置页面（要完成此步骤，必须先完成对 "),a("strong",[t._v("Network")]),t._v(" 的设置。）：\n"),a("ul",[a("li",[a("strong",[t._v("Auto Scaling Group")]),t._v("：由于在 "),a("strong",[t._v("Presets (预设)")]),t._v(" 部分选择了 "),a("em",[a("strong",[t._v("High availability")])]),t._v("，所以此处 "),a("strong",[t._v("Environment type")]),t._v(" 值默认为 "),a("em",[a("strong",[t._v("Load balanced")])]),t._v("，不能修改。"),a("strong",[t._v("Instances")]),t._v(" 的 "),a("strong",[t._v("Max")]),t._v(" 值可按需设置，此处我设置为 1。")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Security")]),t._v("，点击 Security 卡片上 Edit 按钮，进入 Security 设置页面：\n"),a("ul",[a("li",[a("strong",[t._v("Virtual machine permissions")]),t._v("：对于 "),a("strong",[t._v("EC2 key pair")]),t._v(" 选择任一密钥文件。")])])]),t._v(" "),a("li",[t._v("对于 "),a("strong",[t._v("Managed Updates")]),t._v("，点击 Managed Updates 卡片上 Edit 按钮，进入 Managed Updates 设置页面：\n"),a("ul",[a("li",[a("strong",[t._v("Managed platform updates")]),t._v("：对于 "),a("strong",[t._v("Managed updates")]),t._v(" 不勾选 "),a("em",[a("strong",[t._v("Enabled")])]),t._v(" ，取消自动更新平台功能。")])])]),t._v(" "),a("li",[t._v("其他选项保持默认值或按需设置")])])]),t._v(" "),a("li",[t._v("点击 "),a("strong",[t._v("Create environment")]),t._v(" 按钮，开始创建新环境。")])]),t._v(" "),a("h4",{attrs:{id:"_5-1-3-部署代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-3-部署代码"}},[t._v("#")]),t._v(" 5.1.3 部署代码")]),t._v(" "),a("p",[t._v("如果环境正常启动并运行，则可开始部署自己的代码到 EB 中：（此处只涉及使用 EB CLI 进行部署）")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("安装 EB CLI，参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-install.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("安装 EB CLI"),a("OutboundLink")],1)])]),t._v(" "),a("li",[a("p",[t._v("配置 EB CLI，参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/eb-cli3-configuration.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("配置 EB CLI"),a("OutboundLink")],1),t._v("（需要先进入代码根目录下，再进行该配置）")])]),t._v(" "),a("li",[a("p",[t._v("部署代码：")]),t._v(" "),a("p",[t._v("在代码目录下执行以下命令进行部署")]),t._v(" "),a("p",[a("code",[t._v("eb deploy")]),a("em",[a("code",{staticStyle:{color:"red"}},[t._v(" environment-name")])])]),t._v(" "),a("p",[t._v("注意： 如果你的应用程序具有诸如语言运行时包之类的依赖项，它可能会尝试在环境创建期间从 Internet 下载并安装这些依赖项，但此操作将失败。要避免发生此失败，请在应用程序的源包中包含所有依赖项包。")])])]),t._v(" "),a("h4",{attrs:{id:"_5-1-4-后续操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-4-后续操作"}},[t._v("#")]),t._v(" 5.1.4 后续操作")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("修改安全组")]),t._v(" "),a("p",[t._v("使用 AWS 的安全工具 "),a("em",[a("strong",[a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/awssupport/latest/user/getting-started.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Trusted Advisor"),a("OutboundLink")],1)])]),t._v(" 检测"),a("a",{attrs:{href:"https://console.aws.amazon.com/trustedadvisor/home?#/dashboard",target:"_blank",rel:"noopener noreferrer"}},[t._v("整个环境是否处于安全状态"),a("OutboundLink")],1),t._v("。Elastic Beanstalk 在创建环境的过程中分别为 ELB 和 Instance 自动创建了安全组。如下")]),t._v(" "),a("p",[t._v("ELB security group：（sg-aaaaaaaaa）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HTTP")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("80")]),t._v(" "),a("td",[t._v("0.0.0.0/0")])])])]),t._v(" "),a("p",[t._v("Instance security group：（sg-bbbbbbbbb）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HTTP")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("80")]),t._v(" "),a("td",[t._v("sg-aaaaaaaaa")])]),t._v(" "),a("tr",[a("td",[t._v("SSH")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("22")]),t._v(" "),a("td",[t._v("0.0.0.0/0")])])])]),t._v(" "),a("p",[t._v("修改 Instance security group，以收紧实例访问权限，修改后 security group：（sg-bbbbbbbbb）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("HTTP")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("80")]),t._v(" "),a("td",[t._v("sg-aaaaaaaaa")])])])]),t._v(" "),a("p",[t._v("再次"),a("a",{attrs:{href:"https://console.aws.amazon.com/trustedadvisor/home?#/dashboard",target:"_blank",rel:"noopener noreferrer"}},[t._v("检测环境是否处于安全状态"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("li",[a("p",[t._v("检查 instance 运行状况并"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/environment-health-console.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("监控 EB 环境"),a("OutboundLink")],1)])])]),t._v(" "),a("p",[t._v("至此，使用 EB 在 Private VPC 中创建环境并部署代码所有步骤已经完成。")]),t._v(" "),a("p",[a("strong",[t._v("使用 EB 在 Private VPC 中创建环境并部署代码时需要重点注意的点")]),t._v("：")]),t._v(" "),a("ol",[a("li",[a("strong",[t._v("如果只有一台 Instance 也需要创建 ELB。并且将 ELB 指向内部（internal）。如果要为某个环境创建 ELB，则该环境下必须至少有两个 subnet 。")])]),t._v(" "),a("li",[t._v("安全组选择 VPC 默认安全组。（确保 EB 启动的实例可以被 Endpoint 访问到）")])]),t._v(" "),a("h3",{attrs:{id:"_5-2-关于将-elastic-beanstalk-和-amazon-vpc-结合使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-关于将-elastic-beanstalk-和-amazon-vpc-结合使用"}},[t._v("#")]),t._v(" 5.2 关于将 Elastic Beanstalk 和 Amazon VPC 结合使用")]),t._v(" "),a("p",[t._v("参考"),a("a",{attrs:{href:"https://docs.aws.amazon.com/zh_cn/elasticbeanstalk/latest/dg/vpc.html#services-vpc-private",target:"_blank",rel:"noopener noreferrer"}},[t._v("私有 VPC"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"_6-使-private-vpc-中的实例通过-peering-connection-连接到对等-vpc-的-rds-中"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-使-private-vpc-中的实例通过-peering-connection-连接到对等-vpc-的-rds-中"}},[t._v("#")]),t._v(" 6. 使 Private VPC 中的实例通过 Peering Connection 连接到对等 VPC 的 RDS 中")]),t._v(" "),a("p",[t._v("要使 Private VPC 中的实例通过 Peering Connection 连接到对等 VPC 的 RDS 中，必须先创建 Peering Connection，即完成"),a("a",{attrs:{href:"#_3-%E5%88%9B%E5%BB%BA-vpc-%E5%AF%B9%E7%AD%89%E8%BF%9E%E6%8E%A5-peering-connection"}},[t._v("上述第 3 点")]),t._v("。")]),t._v(" "),a("p",[t._v("完成对等连接创建后，只需修改对等 VPC 中 RDS 安全组，以允许 Private VPC 中的 CIDR 块有权限访问。")]),t._v(" "),a("p",[t._v("在 RDS 安全组中添加如下入站规则：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Type")]),t._v(" "),a("th",[t._v("Protocol")]),t._v(" "),a("th",[t._v("Port range")]),t._v(" "),a("th",[t._v("Source")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("MYSQL/Aurora")]),t._v(" "),a("td",[t._v("TCP")]),t._v(" "),a("td",[t._v("3306")]),t._v(" "),a("td",[t._v("172.16.0.0/25")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("其中 "),a("strong",[t._v("Source")]),t._v(" 的值为 Private VPC CIDR 块或者其子网 CIDR 块。")])]),t._v(" "),a("p",[t._v("完。")])],1)}),[],!1,null,null,null);e.default=v.exports}}]);